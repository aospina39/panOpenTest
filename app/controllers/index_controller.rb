class IndexController < ApplicationController
  def index
      @courses = Course.getCurse.as_json
      @course_books = CourseBook.all
      @user_books = UserHasCourseBook.all.order(:reading_times)
      
      @courses.each do |course|
        course['course_books'] = @course_books.select{|c| c['course_id'] == course['id'] }.as_json 
        course['course_books'].each do |book|
          book['users_book'] = @user_books.select{|user| user['course_book_id'] == book['id'] } 
        end
      end
     

  end

  def change_name
      params[:email] = params[:email].strip
      user = User.find_by('email=?',params[:email])
      msg = 'El usuario no existe'
      if !user.blank?
        user.name_user = params[:name_user]
        user.save
        msg = 'Usuario Actualizado'
      end

      render :json => {
        :error => false,
        :msg => msg,
      }

  end
end
